

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyzag &mdash; pyzag 1.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=58fbf978"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorials" href="tutorials/tutorials.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            pyzag
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Additional topics:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/api.html">API documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">pyzag</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">pyzag</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pyzag">
<h1>pyzag<a class="headerlink" href="#pyzag" title="Link to this heading"></a></h1>
<p>pyzag is a library for efficiently training generic models defined with a recursive nonlinear function.</p>
</section>
<section id="installing">
<h1>Installing<a class="headerlink" href="#installing" title="Link to this heading"></a></h1>
<p>pyzag is a pure python package and can be installed simply with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pyzag</span></code>.</p>
</section>
<section id="nonlinear-recursive-functions">
<h1>Nonlinear recursive functions<a class="headerlink" href="#nonlinear-recursive-functions" title="Link to this heading"></a></h1>
<p>A nonlinear recursive function has the form</p>
<div class="math">
<p><img src="_images/math/7d0b39227cf481806ab2269c09880a9eb0af1142.png" alt="f\left(x_{i-1}, x_i; p\right) =0 \quad \forall i \in \left(1,2,\ldots,n \right)"/></p>
</div><p>with <img class="math" src="_images/math/dc7c3cda5993d9796ded25227057f413793ccb94.png" alt="x"/> the model <em>state</em> (the unknowns to solve for) and <img class="math" src="_images/math/73c85db6fdded6d708121fa9e6e7c70fe14f43cf.png" alt="p"/> the model <em>parameters</em>.  Given the model and an <em>initial condition</em> <img class="math" src="_images/math/8992a55d8250b17282048024333e5dccc43efb1b.png" alt="x_0"/> we can obtain a sequence <img class="math" src="_images/math/a8c025d38410a635dea805431e69e2dafe21b606.png" alt="\mathcal{X} = \left(x_0, x_1, \ldots, x_n \right)"/> by recursively solving the nonlinear equation for <img class="math" src="_images/math/bc0ae70325a6a2f59cf55ab9c3030dba19dc60ac.png" alt="x_n"/>.</p>
<p>While this form seems abstract, it actually practically describes a large number of interesting and useful models.  For example, consider the ordinary differential equation defined by</p>
<div class="math">
<p><img src="_images/math/bed08b3ae3c9a91d014adbca1bc56d943d160c43.png" alt="\dot{x} = g\left(x; p \right)

x(0) = x_0"/></p>
</div><p>We can convert this into a nonlinear recursive equation by applying a numerical time integration scheme, for example the <a class="reference external" href="https://en.wikipedia.org/wiki/Backward_Euler_method">backward Euler method</a>:</p>
<div class="math">
<p><img src="_images/math/f7a53e18afefe044b6392e93824ca6b411b3d179.png" alt="x_{i} = x_{i-1} + g(x_i; p) \Delta t_i"/></p>
</div><p>This algebraic equation has our standard form for a nonlinear recursive model:</p>
<div class="math">
<p><img src="_images/math/ef578fe1802ac7f7639796e39a57ad28a0630756.png" alt="f\left(x_{i-1}, x_i; p \right) = x_i - x_{i-1} - g(x_i; p) \Delta t_i"/></p>
</div><p>However, defining our time series with an algebraic equation, rather than a differential equation, provides access to a range of models that cannot be expressed as ODEs, for example difference equations.</p>
</section>
<section id="training-building-blocks">
<h1>Training building blocks<a class="headerlink" href="#training-building-blocks" title="Link to this heading"></a></h1>
<p>The goal of training is basically to find the parameters <img class="math" src="_images/math/73c85db6fdded6d708121fa9e6e7c70fe14f43cf.png" alt="p"/> for a nonlinear recursive function <img class="math" src="_images/math/0087dc4c88010d941f0240c1e0421177828c0e07.png" alt="f"/> and initial condition <img class="math" src="_images/math/8992a55d8250b17282048024333e5dccc43efb1b.png" alt="x_0"/> such that the resulting sequence <img class="math" src="_images/math/cdb029305a182a46f390e77d5238f445ce0f9603.png" alt="\mathcal{X}"/> best matches a target series <img class="math" src="_images/math/0a9e8e7f7cd188506870d3c5688a743c7ef973d2.png" alt="\hat{\mathcal{X}}"/>.  At a minimum to train a model we need to efficiently generate the time series <img class="math" src="_images/math/cdb029305a182a46f390e77d5238f445ce0f9603.png" alt="\mathcal{X}"/> for different parameter values and, often, for multiple targets.  Additionally, we often need the derivative of the sequence <img class="math" src="_images/math/cdb029305a182a46f390e77d5238f445ce0f9603.png" alt="\mathcal{X}"/> with respect to the model parameters <img class="math" src="_images/math/73c85db6fdded6d708121fa9e6e7c70fe14f43cf.png" alt="p"/>.</p>
<p>pyzag provides a few building block methods for efficiently generating sequences and their derivatives:</p>
<ol class="arabic simple">
<li><p>pyzag can vectorize the simulation for the sequences both for independent instantiations of the same model (i.e. batch vectorization) and also by vectorizing over some number of steps <img class="math" src="_images/math/437210778cbed86f78f777e9fec6b34be1e58c35.png" alt="i"/>.  <a class="reference external" href="https://arxiv.org/abs/2310.08649">This paper</a> describes the basic idea, but pyzag extends the approach to general nonlinear recursive models.  The advantage of the general method is that it can increase the calculation bandwith if batch parallelism alone is not enough to fully utilize the compute device.</p></li>
<li><p>pyzag implements the parameter gradient calculation with the adjoint method.  For long sequences this approach is much more memory efficient compared to automatic differentiation and is also generally more computationally efficient.</p></li>
<li><p>pyzag also provides several methods for solving the resulting batched, time-chunked nonlinear and linear equations and predictors for starting the nonlinear solves based on previously simulated pieces of the sequence.</p></li>
</ol>
</section>
<section id="determinstic-and-stochastic-models">
<h1>Determinstic and stochastic models<a class="headerlink" href="#determinstic-and-stochastic-models" title="Link to this heading"></a></h1>
<p>pyzag is built on top of <a class="reference external" href="https://pytorch.org/">PyTorch</a>, integrating the adjoint calculation into PyTorch AD.
Users can seemlessly define and train deterministic models using PyTorch primitives.</p>
<p>The library also provides helper classes to convert a deterministic model, defined as a nonlinear recursive relation implemented with a PyTorch model (<code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>), into a statistical model using the <a class="reference external" href="https://pyro.ai/">pyro</a> library.  Specifically, pyzag provides methods for automatically converting the deterministic model to a stochastic model by replacing determinsitc parameters with prior distributions as well as methods for converting models into a hierarchical statistical format to provide dependence across multiple sequences.</p>
</section>
<section id="learn-more">
<h1>Learn more<a class="headerlink" href="#learn-more" title="Link to this heading"></a></h1>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Additional topics:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials/deterministic.html">Learning from cannon trajectories: Deterministic example</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/statistical.html">Learning from cannon trajectories: Statistical example</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/statistical_scaling.html">Learning from cannon trajectories: Statistical example with parameter scaling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api/api.html">API documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/nonlinear.html">pyzag.nonlinear</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/chunktime.html">pyzag.chunktime</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/ode.html">pyzag.ode</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/reparametrization.html">pyzag.reparametrization</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/stochastic.html">pyzag.stochastic</a></li>
</ul>
</li>
</ul>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorials/tutorials.html" class="btn btn-neutral float-right" title="Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Argonne National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>